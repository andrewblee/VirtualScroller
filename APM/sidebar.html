<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link href="sidebar.css" rel="stylesheet" />
    <link href="styles/bootstrap.css" rel="stylesheet" />
</head>
<body>
    <div class="filter-section">
        <p>X-scrolled <span id="x-scroll-count">0</span> times.</p>
        <p>Y-scrolled <span id="y-scroll-count">0</span> times.</p>
    </div>
    <div class="header-row">
        <div class="canvas">
        </div>
    </div>
    <div class="header-col">
        <div class="canvas">
        </div>
    </div>
    <div class="grid">
        <div class="canvas">
        </div>
    </div>
    <script src="scripts/jquery-2.1.4.js"></script>
    <script src="scripts/scrolled.js"></script>
    <script>
        var standardsByStandardId = {
            '1': {
                'id': 1,
                'name': '1'
            },
            '2': {
                'id': 2,
                'name': '2'
            },
            '3': {
                'id': 3,
                'name': '3'
            },
            '4': {
                'id': 4,
                'name': '4'
            },
            '5': {
                'id': 5,
                'name': '5'
            },
            '6': {
                'id': 6,
                'name': '6'
            },
            '7': {
                'id': 7,
                'name': '7'
            },
            '8': {
                'id': 8,
                'name': '8'
            },
            '9': {
                'id': 9,
                'name': '9'
            },
            '10': {
                'id': 10,
                'name': '10'
            },
            '11': {
                'id': 11,
                'name': '11'
            },
            '12': {
                'id': 12,
                'name': '12'
            },
            '13': {
                'id': 13,
                'name': '13'
            },
            '14': {
                'id': 14,
                'name': '14'
            },
            '15': {
                'id': 15,
                'name': '15'
            },
            '16': {
                'id': 16,
                'name': '16'
            },
            '17': {
                'id': 17,
                'name': '17'
            },
            '18': {
                'id': 18,
                'name': '18'
            },
            '19': {
                'id': 19,
                'name': '19'
            },
            '20': {
                'id': 20,
                'name': '20'
            },
            '21': {
                'id': 21,
                'name': '21'
            },
            '22': {
                'id': 22,
                'name': '22'
            },
            '23': {
                'id': 23,
                'name': '23'
            },
            '24': {
                'id': 24,
                'name': '24'
            },
            '25': {
                'id': 25,
                'name': '25'
            },
            '26': {
                'id': 26,
                'name': '26'
            },
            '27': {
                'id': 27,
                'name': '27'
            }
        };
        var headerRowDataById = {
            '1': {
                'id': 1,
                'name': '1'
            },
            '2': {
                'id': 2,
                'name': '2'
            },
            '3': {
                'id': 3,
                'name': '3'
            },
            '4': {
                'id': 4,
                'name': '4'
            },
            '5': {
                'id': 5,
                'name': '5'
            },
            '6': {
                'id': 6,
                'name': '6'
            },
            '7': {
                'id': 7,
                'name': '7'
            },
            '8': {
                'id': 8,
                'name': '8'
            },
            '9': {
                'id': 9,
                'name': '9'
            },
            '10': {
                'id': 10,
                'name': '10'
            },
            '11': {
                'id': 11,
                'name': '11'
            },
            '12': {
                'id': 12,
                'name': '12'
            },
            '13': {
                'id': 13,
                'name': '13'
            },
            '14': {
                'id': 14,
                'name': '14'
            },
            '15': {
                'id': 15,
                'name': '15'
            },
            '16': {
                'id': 16,
                'name': '16'
            },
            '17': {
                'id': 17,
                'name': '17'
            },
            '18': {
                'id': 18,
                'name': '18'
            },
            '19': {
                'id': 19,
                'name': '19'
            },
            '20': {
                'id': 20,
                'name': '20'
            },
            '21': {
                'id': 21,
                'name': '21'
            },
            '22': {
                'id': 22,
                'name': '22'
            },
            '23': {
                'id': 23,
                'name': '23'
            },
            '24': {
                'id': 24,
                'name': '24'
            },
            '25': {
                'id': 25,
                'name': '25'
            },
            '26': {
                'id': 26,
                'name': '26'
            },
            '27': {
                'id': 27,
                'name': '27'
            }
        };
        var headerColIds = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27];
        var headerRowIds = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27];
        var HEADER_ROW_BOX_HEIGHT = 100;
        var HEADER_COL_BOX_WIDTH = 200;
        var PAGE_HEIGHT = 400;
        var CELL_BUFFER_COUNT = 4;
        var SCROLL_RESOLUTION_MILLISECONDS = 80;

        setHeaderColHeight(standardsByStandardId);
        setHeaderRowWidth(headerRowDataById);
        populateHeaderCol();
        populateHeaderRow();

        var x = 0;
        $('.header-row').scrolled(SCROLL_RESOLUTION_MILLISECONDS, function () {
            populateHeaderRow();
            $('#x-scroll-count').text(x += 1);
        });

        var y = 0;
        $('.header-col').scrolled(SCROLL_RESOLUTION_MILLISECONDS, function () {
            populateHeaderCol();
            $('#y-scroll-count').text(y += 1);
        });

        function populateHeaderCol() {
            var scrollAmount = $('.header-col').scrollTop();
            var firstCell = Math.floor(scrollAmount / HEADER_ROW_BOX_HEIGHT);
            var headerColHeight = $('.header-col').height();
            var numCellsShowing = Math.round(headerColHeight / HEADER_ROW_BOX_HEIGHT);
            var numCellsShowingPlusBuffer = numCellsShowing + CELL_BUFFER_COUNT;
            populateHeaderColData(headerColIds, firstCell, Math.min(firstCell + numCellsShowingPlusBuffer + 1, headerColIds.length), standardsByStandardId);
        }

        function populateHeaderRow() {
            var scrollAmount = $('.header-row').scrollLeft();
            var firstCell = Math.floor(scrollAmount / HEADER_COL_BOX_WIDTH);
            var headerRowWidth = $('.header-row').width();
            var numCellsShowing = Math.round(headerRowWidth / HEADER_COL_BOX_WIDTH);
            var numCellsShowingPlusBuffer = numCellsShowing + CELL_BUFFER_COUNT;
            populateHeaderRowData(headerRowIds, firstCell, Math.min(firstCell + numCellsShowingPlusBuffer + 1, headerRowIds.length), headerRowDataById);
        }

        function populateHeaderColData(headerColIds, first, last, standardsByStandardId) {
            var i, length, html = '';

            for (i = first; i < last; i++) {
                html += '<div class="header-col-box" style="top:' + i * HEADER_ROW_BOX_HEIGHT + 'px">' + standardsByStandardId[headerColIds[i]].name + '</div>';
            }

            $('.header-col .canvas').html(html);

            for (i = first - 1; i >= Math.max(first - CELL_BUFFER_COUNT, 0) ; i--) {
                $('.header-col .canvas').prepend('<div class="header-col-box" style="top:' + i * HEADER_ROW_BOX_HEIGHT + 'px">' + standardsByStandardId[headerColIds[i]].name + '</div>');
            }
        }

        function populateHeaderRowData(headerRowIds, first, last, headerRowDataById) {
            var i, length, html = '';

            for (i = first; i < last; i++) {
                html += '<div class="header-row-box" style="left:' + i * HEADER_COL_BOX_WIDTH + 'px">' + headerRowDataById[headerRowIds[i]].name + '</div>';
            }

            $('.header-row .canvas').html(html);

            for (i = first - 1; i >= Math.max(first - CELL_BUFFER_COUNT, 0) ; i--) {
                $('.header-row .canvas').prepend('<div class="header-row-box" style="left:' + i * HEADER_COL_BOX_WIDTH + 'px">' + headerRowDataById[headerRowIds[i]].name + '</div>');
            }
        }

        function setHeaderColHeight(standardsByStandardId) {
            $('.header-col .canvas').height(Object.keys(standardsByStandardId).length * HEADER_ROW_BOX_HEIGHT);
        }

        function setHeaderRowWidth(headerRowDataById) {
            $('.header-row .canvas').width(Object.keys(headerRowDataById).length * HEADER_COL_BOX_WIDTH);
            //$('.header-row .canvas').width(10000);
        }

        $(document).keydown(function (e) {
            switch (e.which) {
                case 33: // page up
                    console.log('page up');
                    var scrollAmount = $('.header-col').scrollTop();
                    $('.header-col').scrollTop(scrollAmount - PAGE_HEIGHT);
                    break;

                case 34: // page down
                    console.log('page down');
                    var scrollAmount = $('.header-col').scrollTop();
                    $('.header-col').scrollTop(scrollAmount + PAGE_HEIGHT);
                    break;

                case 37: // left
                    console.log('header-col');
                    break;

                case 38: // up
                    console.log('up');
                    var scrollAmount = $('.header-col').scrollTop();
                    $('.header-col').scrollTop(scrollAmount - HEADER_ROW_BOX_HEIGHT);
                    break;

                case 39: // right
                    console.log('right');
                    break;

                case 40: // down
                    console.log('down');
                    var scrollAmount = $('.header-col').scrollTop();
                    $('.header-col').scrollTop(scrollAmount + HEADER_ROW_BOX_HEIGHT);
                    break;

                default: return; // exit this handler for other keys
            }
            e.preventDefault(); // prevent the default action (scroll / move caret)
        });
    </script>
</body>
</html>
